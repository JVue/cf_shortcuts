#!/bin/bash
# Query VMDB for MIQ Server hostnames and associated zones and dynamically build the content of cfhosts.
# Results printed to STDOUT.  Redirect to cfhosts to save.

echo 1>&2
echo "Redirect standard output of this command to your cfhosts file if desired." 1>&2
echo "Enter VMDB database password if prompted." 1>&2
echo 1>&2
echo "# cfhosts content generated by gen_cfhosts.  See gen_cfhosts to regenerate if desired."
echo "#"

cd /var/www/miq/vmdb

echo 'select miq_servers.hostname, zones.name from miq_servers join zones on zones.id = miq_servers.zone_id;' | rails db | awk '$1!="hostname" && !/^---/ && !/^\(/ {print}' | sed -e 's/ //g' -e 's/|/ /' -e '/^$/d'

cd - > /dev/null
